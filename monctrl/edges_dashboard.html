<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="http://loco.lab.asu.edu/share/jquery-1.10.1.min.js"></script>
    <script src="jquery.csv-0.71.min.js"></script>
    <script type="text/javascript">
    
    // Load the Visualization API and the controls package.
    google.load('visualization', '1.0', {'packages':['controls']});

      
    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(onLoad);
      
    function onLoad()
    {
      $.get("file:///C:/Users/jdbowman/Downloads/edges_c/status_spectrometer.txt", onReadTextFile);
    }   

// Useful example page:
//http://jquery-csv.googlecode.com/git/examples/google-visualization.html

function format2D(a) {
    var str = "[";
    for (var i = 0; i<a.length; i++) {
        str+="["+a[i].toString()+"],";
    }
    str=str.substr(0,str.length-1);
    str+="]";
    return str;
}



    function onReadTextFile(text)
    {
      //alert(text);
  
      // Set the text in the spectrometer div
      $("div#status_spectrometer").text(text);
       		
      // Remove the first lines of the file leaving only the spectrum
      var csvText = text.substring(text.indexOf("Data:\n") + 6);

      // Transform the CSV string into a 2-dimensional array
      var arrayData = $.csv.toArrays(csvText, {onParseValue: $.csv.hooks.castToScalar});

      //alert(JSON.stringify(jsonData));
      //$("div#status_spectrometer").text(format2D(arrayData));
      
	  
	var rangeData = [];
	var chartData = [];
	for (var i = 0; i < arrayData.length; ++i) {
		if (i % 100 === 0) {
			rangeData.push(arrayData[i]);
		}
		if (i % 100 == 0) {
			chartData.push(arrayData[i]);
		}
	}
      // Draw the chart
      drawChart(chartData);
    }



    function drawChart(chartData) {
	
	    $.support.cors = true;

      // this new DataTable object holds all the data
      var chartDataTable = new google.visualization.arrayToDataTable(chartData);

      var dashboard = new google.visualization.Dashboard(
          document.getElementById('dashboard_div'));

      // Create the chart
      var chart = new google.visualization.ChartWrapper({
          'chartType': 'LineChart',
          'containerId': 'chart_div',
          'options': {
            'chartArea': {'width': '85%', 'height': '75%'},
            'legend': {'position': 'in'},
            'hAxis': {'title': 'Frequency [MHz]'},
		        'vAxis': {'title': 'Power [dB]'}
          }
      });

      // Create a range slider
      var range = new google.visualization.ControlWrapper({
        'controlType': 'ChartRangeFilter',
        'containerId': 'filter_div',
        'options': {
            'filterColumnLabel': 'Frequency',
            'ui': {'chartOptions': {
                    'chartArea': {'width': '85%', 'height': '100%'},
                    'hAxis': {'textPosition': 'none'},
                    'vAxis': {'gridlines': {'color': 'gray'}}
            }}
        }
      });
	  
      // Establish dependencies, declaring that 'range' drives 'chart'
      dashboard.bind(range, chart);

      // Draw the dashboard.
      dashboard.draw(chartDataTable);

    }
    </script>
  </head>
  <body>
    <div id="dashboard_div">
      <!--Divs that will hold each control and chart-->
      <div id="chart_div" style="width:800px; height:400px"></div>
      <div id="filter_div" style="width:800px; height:100px"></div>
    </div>  
    <div>
      <div style="width: 800px; height: 100px; background-color: #E0E0E0; text-align:center; vertical-align:middle;">
        <p valign="middle"><h2>Spectrometer Status</h2></p>
      </div>
      <pre><div id="status_spectrometer"></div></pre>
    </div>
  </body>
</html>
